doctype HTML
html
	head
		meta(charset="utf-8")
		meta(name="viewport" content="width=device-width initial-scale=1.0")
		title 测试结果集
		link(rel="stylesheet" type="text/css" href="css/themes/mytheme.min.css")
		link(rel="stylesheet" type="text/css" href="css/themes/jquery.mobile.icons.min.css")
		link(rel="stylesheet" type="text/css" href="css/jquery.mobile.structure-1.4.3.min.css")
		link(rel="stylesheet" type="text/css" href="css/base.css")
		link(rel="stylesheet" type="text/css" href="css/test.css")
		style.
			.clearfix:after {
				visibility: hidden;
				display: block;
				font-size: 0;
				content: " ";
				clear: both;
				height: 0;
				}
		script(src="js/jquery-1.8.3.min.js")
	body(class="ui-nosvg")
		div(data-role="page" data-theme="a" class='ui-page-theme-a ui-page')
			div(class="header" data-role="header") 
				hi(class="ui-title" role="heading") ManualTest
				a(href="javascript:;" onclick="if(storeInfo()){page='test';$.mobile.navigate('/test');}return false;" class="ui-icon-check ui-btn-right ui-btn ui-btn-icon-left ui-shadow ui-corner-all") done
			div(class="main" data-role="main")
				form(id="infoForm" action="/login" method="post")
					input(type="text" name="tester" placeholder="您的姓名")
					input(type="text" name="device" placeholder="手机型号")
					select(name="plan")
						option(value="") 请选择测试计划
						each plan in plans
							option(value=plan.id)= plan.content
					select(name="system")
						option(value="") 请选择测试机器的操作系统
						optgroup(label="Android 2.x")
							option(value="Android 2.1") Android 2.1
							option(value="Android 2.2") Android 2.2
							option(value="Android 2.3") Android 2.3
						optgroup(label="Android 4.x")
							option(value="Android 4.0") Android 4.0
							option(value="Android 4.1") Android 4.1
							option(value="Android 4.2") Android 4.2
							option(value="Android 4.3") Android 4.3
							option(value="Android 4.4") Android 4.4
		
		script(src="js/jquery.mobile-1.3.2.min.js")
		script(src="js/tester.js")
		script.
			var info = {}, Cases = [],page = 'login', current,
				HEI = $(window).height(),
				WID = $(window).width();
			var storeInfo = function(){
				var  res = true;
				$('input,select', '#infoForm').each(function(ind, dom){
					if(dom.name && !dom.value){
						res = false;
						return false;
					} 
					info[dom.name] = dom.value;
				});
				return res;
			};
			$(document).on('pageinit', function(){
				// 初始化test页面
				if(page == 'test'){
					if(Cases.length && current){
						current.initIfr();
						current.refresh();
					}else if(Cases.length){
						var opts = $.extend({}, info, {cases: Cases}); 
						new Test(opts);
					}else{
						// fetch file names
						$.getJSON('/getFiles',function(data){
							$.each(data, function(ind, d){
								Cases.push(d);
							});
							var opts = $.extend({}, info, {cases: Cases}); 
							new Test(opts);
						});
					}
					$('.main').height(HEI - 154);
				}else if(page == 'report'){
					current.drawReport();
				}
				//.width(WID - 60)
			});
			
			$(document).on('scrollstop', function(e){
				var top = $(this).scrollTop();
				$('.footer')[0].style.bottom = -top + 'px';
			});
			
			


				

